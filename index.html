<!DOCTYPE html>
<html>
<head>
  <title>Bake your cake</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.3.0/dist/aframe-physics-system.min.js"></script>
  <style>
    body, html { margin:0; padding:0; height:100%; width:100%; font-family:sans-serif; }

    /* Start & choice screens fill desktop */
    #startScreen, #cakeChoices { 
      position:absolute; top:0; left:0; width:100%; height:100%; 
      display:flex; flex-direction:column; justify-content:center; align-items:center; 
      background-size:cover; background-position:center; background-repeat:no-repeat;
      background-attachment:fixed;
      z-index:10; 
    }
    #startScreen { 
      background-image: url('https://cdn.pixabay.com/photo/2015/01/14/19/20/bake-599521_1280.jpg');
    }
    #cakeChoices { 
      background-image: url('https://cdn.pixabay.com/photo/2015/01/14/19/20/bake-599521_1280.jpg');
      display:none; 
    }

    #startScreen::before, #cakeChoices::before { 
      content:""; position:absolute; top:0; left:0; width:100%; height:100%; 
      background: rgba(0,0,0,0.5); z-index:-1; 
    }

    .cake-tab { padding:20px; border-radius:10px; color:white; font-size:20px; cursor:pointer; text-align:center; width:180px; font-weight:bold; margin:10px; }
    #chocolateTab{background-color:#8B4513;} 
    #blueberryTab{background-color:#1E90FF;} 
    #strawberryTab{background-color:#FF69B4;} 
    #cherryTab{background-color:#c71585;}

    #recipePanel { position:absolute; top:20%; left:5%; padding:20px; border-radius:12px; font-size:18px; display:none; z-index:10; min-width:200px; color:white; }
    #recipePanel h2 { margin-top:0; font-size:22px; text-align:center; }
    #recipePanel ul { list-style:none; padding:0; }
    #recipePanel li { margin:5px 0; font-weight:bold; }
    #recipePanel li.collected { color:lightgreen; }
    #recipePanel.strawberry { background-color:#FF69B4; }
    #recipePanel.blueberry { background-color:#1E90FF; }
    #recipePanel.cherry { background-color:#c71585; }

    /* Loading bar */
    #loadingBarContainer {
      position:absolute; bottom:20px; left:50%; transform:translateX(-50%);
      width:60%; height:25px; background:#ddd; border-radius:15px;
      overflow:hidden; display:none; z-index:20;
    }
    #loadingBar {
      width:0%; height:100%; background:#FF69B4; transition:width 5s linear;
    }

    /* Quit button */
    #quitButton {
      position:absolute; top:20px; right:20px;
      padding:12px 20px; border:none; border-radius:8px;
      background:#ff69b4; color:white; font-size:18px; font-weight:bold;
      cursor:pointer; display:none; z-index:30;
    }
  </style>
  <script>
    let currentIngredients = [];
    let currentCake = "";

    function startGame(){
      document.getElementById('startScreen').style.display='none';
      document.getElementById('cakeChoices').style.display='flex';
    }

    function chooseCake(cakeName){
      currentCake = cakeName;
      document.getElementById('cakeChoices').style.display='none';
      document.getElementById('scene').style.display='block';

      const recipePanel = document.getElementById('recipePanel');
      recipePanel.style.display='block';
      recipePanel.className = cakeName;

      if(cakeName==='blueberry'){
        currentIngredients = ["flour","sugar","butter","milk","vanilla","blueberry","strawberry","spatula","whisk"];
      } else if(cakeName==='strawberry'){
        currentIngredients = ["flour","sugar","butter","milk","vanilla","chocolate","strawberry","spatula","whisk"];
      } else if(cakeName==='cherry'){
        currentIngredients = ["flour","sugar","butter","milk","vanilla","cherries","spatula","whisk"];
      }

      recipePanel.innerHTML=`<h2>${cakeName.charAt(0).toUpperCase()+cakeName.slice(1)} Cake</h2>
        <ul>${currentIngredients.map(i=>`<li id="recipe-${i}"><span class="check"></span> ${i}</li>`).join('')}</ul>`;

      // Show all kitchen objects and scale collectables
      document.querySelectorAll('a-entity').forEach(el=>{
        el.setAttribute('visible', true);
        if(el.classList.contains('collectable')){
          el.setAttribute('scale','2 2 2'); // make clickable
        }
      });
    }

    // Collectable component
    AFRAME.registerComponent('collectable',{
      init:function(){
        this.el.addEventListener('click', ()=>{
          const name = this.el.getAttribute('data-name');
          if(currentIngredients.includes(name)){
            this.el.setAttribute('visible', false); // disappear
            const li = document.getElementById(`recipe-${name}`);
            if(li){ li.querySelector('.check').textContent="âœ…"; li.classList.add('collected'); }

            // Check if all collected
            const allCollected = currentIngredients.every(i=>{
              const li=document.getElementById(`recipe-${i}`);
              return li && li.classList.contains("collected");
            });
            if(allCollected) showLoadingBar();
          }
        });
      }
    });

    // Show loading bar, then cake + quit
    function showLoadingBar(){
      const barContainer=document.getElementById('loadingBarContainer');
      const bar=document.getElementById('loadingBar');
      barContainer.style.display='block';
      bar.style.width='0%';
      setTimeout(()=>{bar.style.width='100%';},100);

      setTimeout(()=>{
        barContainer.style.display='none';
        document.getElementById('quitButton').style.display='block';
        // Show cake depending on type
        let cakeModel = "cake.glb";
        if(currentCake === "strawberry"){ cakeModel = "strawberrycake.glb"; }
        if(currentCake === "blueberry"){ cakeModel = "blueberrycake.glb"; }
        if(currentCake === "cherry"){ cakeModel = "cherrycake.glb"; }

        const cake=document.createElement('a-entity');
        cake.setAttribute('gltf-model', cakeModel);
        cake.setAttribute('position','0 1 -2');
        document.querySelector('a-scene').appendChild(cake);
      },5000);
    }

    // Quit resets to start screen
    function quitGame(){
      document.getElementById('scene').style.display='none';
      document.getElementById('recipePanel').style.display='none';
      document.getElementById('quitButton').style.display='none';
      document.getElementById('startScreen').style.display='flex';
      document.querySelectorAll("a-entity[gltf-model$='.glb']").forEach(el=>{
        if(el.getAttribute("gltf-model").includes("cake")) el.remove();
      });
    }
  </script>
</head>
<body>
  <div id="startScreen">
    <h1 style="color:white;">Bake your cake</h1>
    <button onclick="startGame()">Start</button>
  </div>

  <div id="cakeChoices">
    <div id="strawberryTab" class="cake-tab" onclick="chooseCake('strawberry')">Strawberry Cake</div>
    <div id="blueberryTab" class="cake-tab" onclick="chooseCake('blueberry')">Blueberry Cake</div>
    <div id="cherryTab" class="cake-tab" onclick="chooseCake('cherry')">Cherry Cake</div>
  </div>

  <div id="recipePanel"></div>
  <div id="loadingBarContainer"><div id="loadingBar"></div></div>
  <button id="quitButton" onclick="quitGame()">Quit</button>

  <!-- === SCENE === -->
  <a-scene id="scene" style="display:none;" physics="gravity: -9.8;">
    <!-- Camera raised to y=6 -->
    <a-entity position="0 6 7">
      <a-camera><a-cursor rayOrigin="mouse" fuse="false" material="color:black; shader:flat"></a-cursor></a-camera>
    </a-entity>

    <a-entity light="type:ambient; intensity:0.5"></a-entity>
    <a-entity light="type:directional; intensity:0.8" position="0 2 1"></a-entity>

    <!-- Kitchen -->
    <a-entity id="leftwall" gltf-model="leftwall.glb" static-body></a-entity>
    <a-entity id="backwall" gltf-model="backwall.glb" static-body></a-entity>
    <a-entity id="banana" gltf-model="banana.glb" static-body></a-entity>
    <a-entity id="chefhat" gltf-model="chefhat.glb" static-body></a-entity>
    <a-entity id="countersandsink" gltf-model="countersandsink.glb" static-body></a-entity>
    <a-entity id="countertopdecor" gltf-model="countertopdecor.glb" static-body></a-entity>
    <a-entity id="cuttingboard" gltf-model="cuttingboard.glb" static-body></a-entity>
    <a-entity id="exhaustfan" gltf-model="exhaustfan.glb" static-body></a-entity>
    <a-entity id="egg" gltf-model="egg.glb" static-body></a-entity>
    <a-entity id="eggcarton" gltf-model="eggcarton.glb" static-body></a-entity>
    <a-entity id="floor" gltf-model="floor.glb" static-body></a-entity>
    <a-entity id="fridge" gltf-model="fridge.glb" static-body></a-entity>
    <a-entity id="frontwall" gltf-model="frontwall.glb" static-body></a-entity>
    <a-entity id="fruitbowl" gltf-model="fruitbowl.glb" static-body></a-entity>
    <a-entity id="light" gltf-model="light.glb" static-body></a-entity>
    <a-entity id="leftroof" gltf-model="leftroof.glb" static-body></a-entity>
    <a-entity id="rightroof" gltf-model="rightroof.glb" static-body></a-entity>
    <a-entity id="mixingbowl" gltf-model="mixingbowl.glb" static-body></a-entity>
    <a-entity id="mug1" gltf-model="mug1.glb" static-body></a-entity>
    <a-entity id="pan" gltf-model="pan.glb" static-body></a-entity>
    <a-entity id="peanutbutter" gltf-model="peanutbutter.glb" static-body></a-entity>
    <a-entity id="plate" gltf-model="plate.glb" static-body></a-entity>
    <a-entity id="radio" gltf-model="radio.glb" static-body></a-entity>
    <a-entity id="rightwall" gltf-model="rightwall.glb" static-body></a-entity>
    <a-entity id="rollingpin" gltf-model="rollingpin.glb" static-body></a-entity>
    <a-entity id="knife" gltf-model="knife.glb" static-body></a-entity>
    <a-entity id="salt" gltf-model="salt.glb" static-body></a-entity>
    <a-entity id="smallplate" gltf-model="smallplate.glb" static-body></a-entity>
    <a-entity id="stool" gltf-model="stool.glb" static-body></a-entity>
    <a-entity id="stove" gltf-model="stove.glb" static-body></a-entity>
    <a-entity id="wallclock" gltf-model="wallclock.glb" static-body></a-entity>
    <a-entity id="walldecor" gltf-model="walldecor.glb" static-body></a-entity>
    <a-entity id="walliines" gltf-model="walliines.glb" static-body></a-entity>
    <a-entity id="windowdecor" gltf-model="windowdecor.glb" static-body></a-entity>

    <!-- Collectables -->
    <a-entity id="flour" gltf-model="flour.glb" class="collectable" collectable data-name="flour" position="4 2 0.5">
      <a-box visible="false" scale="5 5 5"></a-box>
    </a-entity>
    <a-entity id="sugar" gltf-model="sugar.glb" class="collectable" collectable data-name="sugar" position="1 2 0.5">
      <a-box visible="false" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="butter" gltf-model="butter.glb" class="collectable" collectable data-name="butter" position="-2 2 1.5">
      <a-box visible="false" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="milk" gltf-model="milk.glb" class="collectable" collectable data-name="milk" position="7 2 1">
      <a-box visible="false" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="vanilla" gltf-model="vanilla.glb" class="collectable" collectable data-name="vanilla" position="-3 2 1">
      <a-box visible="false" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="blueberry" gltf-model="blueberry.glb" class="collectable" collectable data-name="blueberry" position="5 2 2">
      <a-box visible="false" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="strawberry" gltf-model="strawberry.glb" class="collectable" collectable data-name="strawberry" position="8 2 2">
      <a-box visible="false" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="spatula" gltf-model="spatula.glb" class="collectable" collectable data-name="spatula" position="-4 2 2.5">
      <a-box visible="false" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="whisk" gltf-model="whisk.glb" class="collectable" collectable data-name="whisk" position="6 2 2.5">
      <a-box visible="false" scale="4 4 4"></a-box>
    </a-entity>
    <a-entity id="chocolate" gltf-model="chocolate.glb" class="collectable" collectable data-name="chocolate" position="6 2 2.5">
      <a-box visible="false" scale="5 2 2"></a-box>
    </a-entity>
    <a-entity id="cherries" gltf-model="cherries.glb" class="collectable" collectable data-name="cherries" position="6 2 2.5">
      <a-box visible="false" scale="5 2 2"></a-box>
    </a-entity>

    <a-sound id="mainmusic" src="baking cooking jazz.mp3" autoplay="false" loop="true"></a-sound>
  </a-scene>
</body>
</html>
