<!DOCTYPE html>
<html>
<head>
  <title>Bake your cake</title>
  <meta name="description" content="Bake your cake">
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <style>
    .start-ui, .choice-ui, .bake-ui {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
      text-align: center;
      display: none;
    }

    .start-ui button, .choice-ui button, .bake-ui button {
      margin: 10px;
      padding: 15px 30px;
      font-size: 18px;
      cursor: pointer;
    }

    .choice-box {
      display: inline-block;
      width: 200px;
      padding: 20px;
      margin: 20px;
      border: 2px solid #333;
      border-radius: 10px;
      background: #fff;
      cursor: pointer;
      transition: transform 0.5s ease, opacity 0.5s ease;
    }

    .choice-box:hover {
      background: #f5f5f5;
    }

    /* Left panel for chosen recipe */
    #leftPanel {
      position: absolute;
      top: 20px;
      left: -300px; /* Start hidden offscreen */
      width: 250px;
      background: white;
      padding: 15px;
      border-radius: 10px;
      display: none;
      z-index: 10;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      transition: left 0.7s ease;
    }

    #leftPanel.active {
      left: 20px; /* Slides into view */
    }

    #leftPanel ul {
      text-align: left;
      padding-left: 15px;
    }
  </style>
</head>
<body>
  <!-- Start Screen -->
  <div class="start-ui" id="startScreen" style="display:block;">
    <img src="https://images.pexels.com/photos/9095/pexels-photo.jpg"
         alt="Start Background"
         style="width: 100%; max-width: 600px; border-radius: 10px; margin-bottom: 20px;" />
    <h1>Bake your cake</h1>
    <button onclick="startGame()">Start</button>
    <button onclick="window.close()">Quit</button>
  </div>

  <!-- Cake Choice Screen -->
  <div class="choice-ui" id="choiceScreen">
    <div class="choice-box" onclick="chooseCake('strawberry')">
      <h2>Strawberry Cake</h2>
    </div>
    <div class="choice-box" onclick="chooseCake('blueberry')">
      <h2>Blueberry Cake</h2>
    </div>
  </div>

  <!-- Recipe Panel -->
  <div id="leftPanel"></div>

  <!-- Bake Button -->
  <div class="bake-ui" id="bakeScreen">
    <button onclick="bakeCake()">Bake!</button>
  </div>

  <!-- A-Frame Scene -->
  <a-scene id="scene" vr-mode-ui="enabled: false">
    <!-- Camera -->
    <a-entity id="cameraRig" position="0 1.6 0">
      <a-camera>
        <a-cursor rayOrigin="mouse" fuse="false" material="color: black; shader: flat"></a-cursor>
      </a-camera>
    </a-entity>

    <!-- Lighting -->
    <a-entity light="type: ambient; intensity: 0.5"></a-entity>
    <a-entity light="type: directional; intensity: 0.8" position="0 2 1"></a-entity>

    <!-- Ingredients -->
    <a-entity id="flour" class="ingredient" gltf-model="flour.glb" position="0 1 -3" visible="true"></a-entity>
    <a-entity id="strawberries" class="ingredient" gltf-model="strawberry.glb" position="2 1 -3" visible="true"></a-entity>
    <a-entity id="blueberries" class="ingredient" gltf-model="blueberries.glb" position="-2 1 -3" visible="true"></a-entity>
    <a-entity id="vanilla" class="ingredient" gltf-model="vanilla.glb" position="1 0.5 -2" visible="true"></a-entity>
    <a-entity id="sugar" class="ingredient" gltf-model="sugarbag.glb" position="3 1 -2" visible="true"></a-entity>
    <a-entity id="butter" class="ingredient" gltf-model="butter.glb" position="-3 1 -2" visible="true"></a-entity>
    <a-entity id="milk" class="ingredient" gltf-model="whitebottle.glb" position="0 0.5 -2" visible="true"></a-entity>
    <a-entity id="chocolate" class="ingredient" gltf-model="chocolate.glb" position="-1 1 -2" visible="true"></a-entity>
    <!-- Some extras to act as "wrong" choices -->
    <a-entity id="soap" class="ingredient" gltf-model="soap.glb" position="4 1 -2" visible="true"></a-entity>
    <a-entity id="mugs" class="ingredient" gltf-model="mugs.glb" position="-4 1 -2" visible="true"></a-entity>

    <!-- Cake Result -->
    <a-entity id="finalCake" gltf-model="strawberrychocolatecake.glb" position="0 1 -1" visible="false"></a-entity>

    <!-- Timer Bar -->
    <a-plane id="timerBar" visible="false" position="0 2 -2" width="0.1" height="0.2" color="#4CAF50"></a-plane>

    <!-- Sounds -->
    <a-sound id="correctSound" src="assets/correct.mp3"></a-sound>
    <a-sound id="wrongSound" src="assets/wrong.mp3"></a-sound>
    <a-sound id="mainmusic" src="baking cooking jazz.mp3" autoplay="false" loop="true"></a-sound>
  </a-scene>

  <script>
    let chosenCake = null;
    let requiredIngredients = [];
    let collectedIngredients = [];

    function startGame() {
      document.getElementById('startScreen').style.display = 'none';
      document.getElementById('choiceScreen').style.display = 'block';

      // Restart background music from the beginning
      const music = document.querySelector('#mainmusic');
      if (music && music.components.sound) {
        music.components.sound.stopSound();
        music.components.sound.playSound();
      }
    }

    function chooseCake(cake) {
      chosenCake = cake;
      const choiceScreen = document.getElementById('choiceScreen');
      const leftPanel = document.getElementById('leftPanel');

      // Hide choice screen
      choiceScreen.style.display = 'none';

      // Show left panel
      leftPanel.style.display = 'block';
      leftPanel.classList.add('active');
      leftPanel.innerHTML = `<h2>${cake === 'strawberry' ? 'Strawberry Cake' : 'Blueberry Cake'}</h2>
        <ul id="ingredientList"></ul>`;

      // Define required ingredients
      if (cake === 'strawberry') {
        requiredIngredients = ["flour", "strawberries", "vanilla", "sugar", "butter", "milk", "chocolate"];
      } else {
        requiredIngredients = ["flour", "blueberries", "vanilla", "sugar", "butter", "milk", "chocolate"];
      }

      // Build checklist
      const list = document.getElementById('ingredientList');
      requiredIngredients.forEach(ing => {
        const li = document.createElement('li');
        li.id = `check-${ing}`;
        li.textContent = ing;
        list.appendChild(li);
      });

      // Attach click listeners to all ingredients (correct + wrong)
      document.querySelectorAll('.ingredient').forEach(el => {
        el.addEventListener('click', () => collectIngredient(el.id));
      });
    }

    function collectIngredient(id) {
      if (requiredIngredients.includes(id) && !collectedIngredients.includes(id)) {
        collectedIngredients.push(id);

        // Hide from scene
        const el = document.getElementById(id);
        el.setAttribute('visible', false);

        // Update checklist
        const li = document.getElementById(`check-${id}`);
        if (li) {
          li.style.color = 'green';
          li.style.textDecoration = 'line-through';
        }

        // Play correct sound
        document.querySelector('#correctSound').components.sound.playSound();
      } else {
        // Wrong ingredient
        document.querySelector('#wrongSound').components.sound.playSound();
      }

      // If all collected
      if (collectedIngredients.length === requiredIngredients.length) {
        document.getElementById('bakeScreen').style.display = 'block';
      }
    }

    function bakeCake() {
      document.getElementById('bakeScreen').style.display = 'none';
      const timer = document.getElementById('timerBar');
      timer.setAttribute('visible', true);

      let width = 0.1;
      const interval = setInterval(() => {
        width += 0.1;
        timer.setAttribute('width', width);
      }, 300);

      setTimeout(() => {
        clearInterval(interval);
        timer.setAttribute('visible', false);
        document.getElementById('finalCake').setAttribute('visible', true);
      }, 5000);
    }
  </script>
</body>
</html>
