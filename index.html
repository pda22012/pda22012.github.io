<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bake Your Cake</title>

    <!-- ================================================================ -->
    <!--  CSS STYLES ARE NOW INSIDE THIS FILE                             -->
    <!-- ================================================================ -->
    <style>
        body {
            margin: 0;
            font-family: sans-serif;
            overflow: hidden;
            background-color: #000;
        }
        .screen {
            width: 100vw;
            height: 100vh;
            display: none;
            background-size: cover;
            background-position: center;
        }
        .screen.active {
            display: flex; /* Use Flexbox for easy centering */
            justify-content: center;
            align-items: center;
        }
        model-viewer {
            --mv-viewer-background-color: transparent;
            width: 100%;
            height: 100%;
        }
        #start-screen {
            background-color: #f2d7d5;
            text-align: center;
            flex-direction: column;
        }
        .start-content h1 {
            font-size: 4em;
            color: white;
            text-shadow: 2px 2px 4px #8c4a4a;
        }
        #start-btn, #quit-btn {
            padding: 15px 30px;
            font-size: 1.5em;
            cursor: pointer;
            margin: 10px;
            border: none;
            border-radius: 10px;
        }
        #cake-selection-screen {
            background-color: #f2d7d5;
            gap: 20px;
        }
        .tab {
            padding: 20px 40px;
            font-size: 1.5em;
            cursor: pointer;
            color: white;
            border-radius: 10px;
        }
        #strawberry-cake-tab { background-color: #ffc0cb; }
        #blueberry-cake-tab { background-color: #add8e6; }
        #cherry-cake-tab { background-color: #dc143c; }
        #game-screen {
            background-color: #a3c1ad;
            justify-content: flex-start; /* Align items to the left */
            align-items: stretch; /* Stretch items to fill height */
        }
        #ingredients-list {
            width: 250px;
            background-color: rgba(255, 255, 255, 0.85);
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            z-index: 10;
        }
        #ingredients-list ul {
            list-style-type: none;
            padding: 0;
        }
        #ingredients-list li {
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        #ingredients-list li.collected {
            text-decoration: line-through;
            color: #888;
        }
        #kitchen-area {
            flex-grow: 1;
            position: relative;
        }
        .kitchen-part, .ingredient-object {
            position: absolute;
            top: 0;
            left: 0;
        }
        .kitchen-part {
            pointer-events: none;
        }
        .ingredient-object {
            cursor: pointer;
        }
        .ingredient-object.collected {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        #end-screen {
            flex-direction: column;
            background-color: #f2d7d5;
        }
        #loading-bar-container {
            width: 50%;
            height: 30px;
            border: 2px solid #333;
            border-radius: 5px;
        }
        #loading-bar {
            width: 0%;
            height: 100%;
            background-color: #ffc0cb;
            animation: load 5s linear forwards;
            border-radius: 3px;
        }
        @keyframes load {
            from { width: 0%; }
            to { width: 100%; }
        }
        #final-cake {
            width: 50%;
            height: 50%;
            text-align: center;
        }
        .final-cake-model {
            display: none;
        }
        #end-message {
            margin-top: 20px;
            font-size: 2em;
            color: #333;
        }
    </style>
</head>
<body>

    <!-- ================================================================ -->
    <!--  HTML BODY                                                       -->
    <!-- ================================================================ -->
    <audio id="background-music" loop src="baking cooking jazz.mp3"></audio>

    <div id="start-screen" class="screen active">
        <div class="start-content">
            <h1>Bake Your Cake</h1>
            <button id="start-btn">Start</button>
            <button id="quit-btn">Quit</button>
        </div>
    </div>

    <div id="cake-selection-screen" class="screen">
        <div class="tab" id="strawberry-cake-tab" data-cake="strawberry">Strawberry Cake</div>
        <div class="tab" id="blueberry-cake-tab" data-cake="blueberry">Blueberry Cake</div>
        <div class="tab" id="cherry-cake-tab" data-cake="cherry">Cherry Cake</div>
    </div>

    <div id="game-screen" class="screen">
        <div id="ingredients-list">
            <h2 id="cake-title"></h2>
            <ul>
                <li id="flour">Flour</li>
                <li id="sugar">Sugar</li>
                <li id="egg">Egg</li>
                <li id="vanilla">Vanilla</li>
                <li id="butter">Butter</li>
                <li id="milk">Milk</li>
                <li id="fruit"></li>
            </ul>
        </div>
        <div id="kitchen-area">
            <model-viewer class="kitchen-part" src="backwall.glb"></model-viewer>
            <model-viewer class="kitchen-part" src="counters.glb"></model-viewer>
            <model-viewer class="kitchen-part" src="counterdecor.glb"></model-viewer>
            <model-viewer class="kitchen-part" src="floor.glb"></model-viewer>
            <model-viewer class="kitchen-part" src="fridge.glb"></model-viewer>
            <model-viewer class="kitchen-part" src="frontwall.glb"></model-viewer>
            <model-viewer class="kitchen-part" src="leftwall.glb"></model-viewer>
            <model-viewer class="kitchen-part" src="rightwall.glb"></model-viewer>
            <model-viewer class="kitchen-part" src="roof.glb"></model-viewer>
            <model-viewer class="kitchen-part" src="shelves.glb"></model-viewer>
            <model-viewer class="kitchen-part" src="stool.glb"></model-viewer>
            <model-viewer class="kitchen-part" src="stove.glb"></model-viewer>
            <model-viewer class="kitchen-part" src="light.glb"></model-viewer>
            <model-viewer class="kitchen-part" src="radio.glb"></model-viewer>
            
            <model-viewer class="ingredient-object" data-ingredient="flour" src="flour.glb" camera-controls></model-viewer>
            <model-viewer class="ingredient-object" data-ingredient="sugar" src="sugar.glb" camera-controls></model-viewer>
            <model-viewer class="ingredient-object" data-ingredient="egg" src="egg.glb" camera-controls></model-viewer>
            <model-viewer class="ingredient-object" data-ingredient="vanilla" src="vanilla.glb" camera-controls></model-viewer>
            <model-viewer class="ingredient-object" data-ingredient="butter" src="butter.glb" camera-controls></model-viewer>
            <model-viewer class="ingredient-object" data-ingredient="milk" src="milk.glb" camera-controls></model-viewer>
            
            <model-viewer class="ingredient-object" data-ingredient="strawberry" src="strawberry.glb" style="display: none;" camera-controls></model-viewer>
            <model-viewer class="ingredient-object" data-ingredient="blueberry" src="blueberry.glb" style="display: none;" camera-controls></model-viewer>
            <model-viewer class="ingredient-object" data-ingredient="cherries" src="cherries.glb" style="display: none;" camera-controls></model-viewer>
        </div>
    </div>

    <div id="end-screen" class="screen">
        <div id="loading-bar-container">
            <div id="loading-bar"></div>
        </div>
        <div id="final-cake" style="display: none;">
            <model-viewer id="strawberry-cake-final" class="final-cake-model" src="strawberrycake.glb" camera-controls auto-rotate></model-viewer>
            <model-viewer id="blueberry-cake-final" class="final-cake-model" src="blueberrycake.glb" camera-controls auto-rotate></model-viewer>
            <model-viewer id="cherry-cake-final" class="final-cake-model" src="cherrycake4.glb" camera-controls auto-rotate></model-viewer>
            <h2 id="end-message"></h2>
        </div>
    </div>

    <!-- This script link is required by Google for <model-viewer> to work -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>

    <!-- ================================================================ -->
    <!--  JAVASCRIPT IS NOW INSIDE THIS FILE                              -->
    <!-- ================================================================ -->
    <script>
        // Wait until the entire page is loaded before running the game logic
        document.addEventListener('DOMContentLoaded', () => {
            console.log("Game script starting...");

            const startBtn = document.getElementById('start-btn');
            if (!startBtn) {
                console.error("FATAL ERROR: Could not find the 'start-btn' element. Check the HTML.");
                return; // Stop everything if the button isn't found
            }

            const quitBtn = document.getElementById('quit-btn');
            const backgroundMusic = document.getElementById('background-music');
            const startScreen = document.getElementById('start-screen');
            const cakeSelectionScreen = document.getElementById('cake-selection-screen');
            const gameScreen = document.getElementById('game-screen');
            const endScreen = document.getElementById('end-screen');
            const cakeTabs = document.querySelectorAll('.tab');
            const cakeTitle = document.getElementById('cake-title');
            const fruitIngredientListItem = document.getElementById('fruit');

            const baseIngredients = ['flour', 'sugar', 'egg', 'vanilla', 'butter', 'milk'];
            let allIngredientsForCake = [];
            let currentCake = '';
            let collectedIngredients = [];

            // --- Event Listeners ---
            startBtn.addEventListener('click', () => {
                console.log("Start button clicked!");
                backgroundMusic.play().catch(e => console.warn("Audio play failed. User must interact with the page first."));
                startScreen.classList.remove('active');
                cakeSelectionScreen.classList.add('active');
            });

            quitBtn.addEventListener('click', () => {
                window.close();
            });

            cakeTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    currentCake = tab.dataset.cake;
                    cakeSelectionScreen.classList.remove('active');
                    gameScreen.classList.add('active');
                    setupGame();
                });
            });

            document.getElementById('kitchen-area').addEventListener('click', (event) => {
                const clickedObject = event.target.closest('.ingredient-object');
                if (clickedObject && !clickedObject.classList.contains('collected')) {
                    collectIngredient(clickedObject.dataset.ingredient);
                }
            });

            // --- Game Functions ---
            function setupGame() {
                collectedIngredients = [];
                document.querySelectorAll('#ingredients-list li').forEach(li => li.classList.remove('collected'));
                document.querySelectorAll('.ingredient-object').forEach(obj => {
                    obj.classList.remove('collected');
                    obj.style.display = 'block';
                });

                document.querySelector('.ingredient-object[data-ingredient="strawberry"]').style.display = 'none';
                document.querySelector('.ingredient-object[data-ingredient="blueberry"]').style.display = 'none';
                document.querySelector('.ingredient-object[data-ingredient="cherries"]').style.display = 'none';

                if (currentCake === 'strawberry') {
                    cakeTitle.textContent = 'Strawberry Cake';
                    fruitIngredientListItem.textContent = 'Strawberry';
                    allIngredientsForCake = [...baseIngredients, 'strawberry'];
                    document.querySelector('.ingredient-object[data-ingredient="strawberry"]').style.display = 'block';
                } else if (currentCake === 'blueberry') {
                    cakeTitle.textContent = 'Blueberry Cake';
                    fruitIngredientListItem.textContent = 'Blueberry';
                    allIngredientsForCake = [...baseIngredients, 'blueberry'];
                    document.querySelector('.ingredient-object[data-ingredient="blueberry"]').style.display = 'block';
                } else if (currentCake === 'cherry') {
                    cakeTitle.textContent = 'Cherry Cake';
                    fruitIngredientListItem.textContent = 'Cherries';
                    allIngredientsForCake = [...baseIngredients, 'cherries'];
                    document.querySelector('.ingredient-object[data-ingredient="cherries"]').style.display = 'block';
                }
            }

            function collectIngredient(ingredientName) {
                if (!collectedIngredients.includes(ingredientName)) {
                    collectedIngredients.push(ingredientName);
                    document.querySelector(`.ingredient-object[data-ingredient="${ingredientName}"]`).classList.add('collected');

                    let listItem = (['strawberry', 'blueberry', 'cherries'].includes(ingredientName))
                        ? fruitIngredientListItem
                        : document.getElementById(ingredientName);
                    
                    if (listItem) listItem.classList.add('collected');

                    if (collectedIngredients.length === allIngredientsForCake.length) {
                        finishGame();
                    }
                }
            }

            function finishGame() {
                setTimeout(() => {
                    gameScreen.classList.remove('active');
                    endScreen.classList.add('active');

                    setTimeout(() => {
                        document.getElementById('loading-bar-container').style.display = 'none';
                        document.getElementById('final-cake').style.display = 'block';
                        document.querySelectorAll('.final-cake-model').forEach(model => model.style.display = 'none');
                        document.getElementById(`${currentCake}-cake-final`).style.display = 'block';
                        document.getElementById('end-message').textContent = 'have a piece';
                    }, 5000);
                }, 500);
            }
        });
    </script>

</body>
</html>
