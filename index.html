<!DOCTYPE html>
<html>
<head>
  <title>Bake your cake</title>
  <!-- A-Frame Core -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <!-- A-Frame Physics System -->
  <script src="https://cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.3.0/dist/aframe-physics-system.min.js"></script>
  
  <style>
    body, html { margin:0; padding:0; height:100%; width:100%; font-family:sans-serif; overflow: hidden; }
    #startScreen, #cakeChoices { position:absolute; top:0; left:0; width:100%; height:100%; display:flex; flex-direction:column; justify-content:center; align-items:center; background-size:cover; z-index:10; }
    #startScreen { background: url('https://cdn.pixabay.com/photo/2015/01/14/19/20/bake-599521_1280.jpg') no-repeat center center; }
    #startScreen::before, #cakeChoices::before { content:""; position:absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index:-1; }
    #cakeChoices { background: url('https://cdn.pixabay.com/photo/2015/01/14/19/20/bake-599521_1280.jpg') no-repeat center center; display:none; }
    .cake-tab { padding:20px; border-radius:10px; color:white; font-size:20px; cursor:pointer; text-align:center; width:180px; font-weight:bold; margin:10px; }
    #strawberryTab{background-color:#FF6347;} #blueberryTab{background-color:#1E90FF;} #cherryTab{background-color:#FF69B4;}
    #recipePanel { position:absolute; top:20%; left:5%; padding:20px; border-radius:12px; font-size:18px; display:none; z-index:10; min-width:200px; color:white; }
    #recipePanel h2 { margin-top:0; font-size:22px; text-align:center; }
    #recipePanel ul { list-style:none; padding:0; }
    #recipePanel li { margin:8px 0; font-weight:bold; cursor: pointer; transition: color 0.3s; }
    #recipePanel li.collected { color:lightgreen; cursor: default; text-decoration: line-through;}
    #recipePanel.strawberry { background-color: rgba(255, 99, 71, 0.8); }
    #recipePanel.blueberry { background-color: rgba(30, 144, 255, 0.8); }
    #recipePanel.cherry { background-color: rgba(255, 105, 180, 0.8); }
    
    #loading-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 50%; max-width: 400px; background-color: #333; border: 2px solid white; border-radius: 10px; padding: 5px; display: none; z-index: 9999; }
    #loading-bar { width: 0%; height: 30px; background-color: #4CAF50; border-radius: 5px; text-align: center; line-height: 30px; color: white; transition: width 0.1s linear; }
    #loading-text { position: absolute; width: 100%; text-align: center; top: -35px; color: white; font-size: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <div id="startScreen">
    <h1 style="color:white;">Bake your cake</h1>
    <button onclick="startGame()">Start</button>
  </div>

  <div id="cakeChoices">
    <div id="strawberryTab" class="cake-tab" onclick="chooseCake('strawberry')">Strawberry Cake</div>
    <div id="blueberryTab" class="cake-tab" onclick="chooseCake('blueberry')">Blueberry Cake</div>
    <div id="cherryTab" class="cake-tab" onclick="chooseCake('cherry')">Cherry Cake</div>
  </div>

  <div id="recipePanel"></div>
  
  <div id="loading-container">
    <div id="loading-text">Baking...</div>
    <div id="loading-bar">0%</div>
  </div>
  
  <a-scene id="scene" physics="gravity:-9.8" style="display:none;">
    <a-assets timeout="10000">
      <!-- GLB Models -->
      <a-asset-item id="backwall-model" src="backwall.glb"></a-asset-item>
      <a-asset-item id="frontwall-model" src="frontwall.glb"></a-asset-item>
      <a-asset-item id="rightwall-model" src="rightwall.glb"></a-asset-item>
      <a-asset-item id="leftwall-model" src="leftwall.glb"></a-asset-item>
      <a-asset-item id="floor-model" src="floor.glb"></a-asset-item>
      <a-asset-item id="fridge-model" src="fridge.glb"></a-asset-item>
      <a-asset-item id="roof-model" src="roof.glb"></a-asset-item>
      <a-asset-item id="counterdecor-model" src="counterdecor.glb"></a-asset-item>
      <a-asset-item id="counters-model" src="counters.glb"></a-asset-item>
      <a-asset-item id="radio-model" src="radio.glb"></a-asset-item>
      <a-asset-item id="light-model" src="light.glb"></a-asset-item>
      <a-asset-item id="salt-model" src="salt.glb"></a-asset-item>
      <a-asset-item id="eggcarton-model" src="eggcarton.glb"></a-asset-item>
      <a-asset-item id="mixingbowl-model" src="mixingbowl.glb"></a-asset-item>
      <a-asset-item id="cuttingboard-model" src="cuttingboard.glb"></a-asset-item>
      <a-asset-item id="shelves-model" src="shelves.glb"></a-asset-item>
      <a-asset-item id="knife-model" src="knife.glb"></a-asset-item>
      <a-asset-item id="stool-model" src="stool.glb"></a-asset-item>
      <a-asset-item id="stove-model" src="stove.glb"></a-asset-item>
      <a-asset-item id="vanilla-model" src="vanilla.glb"></a-asset-item>
      <a-asset-item id="strawberry-model" src="strawberry.glb"></a-asset-item>
      <a-asset-item id="spatula-model" src="spatula.glb"></a-asset-item>
      <a-asset-item id="whisk-model" src="whisk.glb"></a-asset-item>
      <a-asset-item id="banana-model" src="banana.glb"></a-asset-item>
      
      <!-- Ingredient GLB Models -->
      <a-asset-item id="flour-model" src="flour.glb"></a-asset-item>
      <a-asset-item id="sugar-model" src="sugar.glb"></a-asset-item>
      <a-asset-item id="butter-model" src="butter.glb"></a-asset-item>
      <a-asset-item id="milk-model" src="milk.glb"></a-asset-item>
      <a-asset-item id="egg-model" src="egg.glb"></a-asset-item>
      <a-asset-item id="blueberry-model" src="blueberry.glb"></a-asset-item>
      <a-asset-item id="cherries-model" src="cherries.glb"></a-asset-item>
      <a-asset-item id="chocolate-model" src="chocolate.glb"></a-asset-item>

      <!-- Cake GLB Models -->
      <a-asset-item id="strawberry-cake-model-asset" src="strawberrycake.glb"></a-asset-item>
      <a-asset-item id="blueberry-cake-model-asset" src="blueberrycake.glb"></a-asset-item>
      <a-asset-item id="cherry-cake-model-asset" src="cherrycake1.glb"></a-asset-item>

      <!-- Music -->
      <audio id="mainmusic-asset" src="baking cooking jazz.mp3" preload="auto"></audio>
      
      <!-- Templates for falling ingredients -->
      <a-entity id="flour-template" gltf-model="#flour-model" class="falling-ingredient" data-name="flour" dynamic-body="shape: box; mass: 0.5" visible="false" scale="0.1 0.1 0.1" fade-out></a-entity>
      <a-entity id="sugar-template" gltf-model="#sugar-model" class="falling-ingredient" data-name="sugar" dynamic-body="shape: box; mass: 0.5" visible="false" scale="0.1 0.1 0.1" fade-out></a-entity>
      <a-entity id="butter-template" gltf-model="#butter-model" class="falling-ingredient" data-name="butter" dynamic-body="shape: box; mass: 0.5" visible="false" scale="0.1 0.1 0.1" fade-out></a-entity>
      <a-entity id="milk-template" gltf-model="#milk-model" class="falling-ingredient" data-name="milk" dynamic-body="shape: box; mass: 0.5" visible="false" scale="0.1 0.1 0.1" fade-out></a-entity>
      <a-entity id="egg-template" gltf-model="#egg-model" class="falling-ingredient" data-name="egg" dynamic-body="shape: sphere; radius: 0.04; mass: 0.2" visible="false" scale="0.1 0.1 0.1" fade-out></a-entity>
      <a-entity id="blueberry-template" gltf-model="#blueberry-model" class="falling-ingredient" data-name="blueberry" dynamic-body="shape: sphere; radius: 0.03; mass: 0.1" visible="false" scale="0.1 0.1 0.1" fade-out></a-entity>
      <a-entity id="cherries-template" gltf-model="#cherries-model" class="falling-ingredient" data-name="cherries" dynamic-body="shape: sphere; radius: 0.03; mass: 0.1" visible="false" scale="0.1 0.1 0.1" fade-out></a-entity>
      <a-entity id="chocolate-template" gltf-model="#chocolate-model" class="falling-ingredient" data-name="chocolate" dynamic-body="shape: box; mass: 0.5" visible="false" scale="0.1 0.1 0.1" fade-out></a-entity>
      <a-entity id="strawberry-template" gltf-model="#strawberry-model" class="falling-ingredient" data-name="strawberry" dynamic-body="shape: sphere; radius: 0.05; mass: 0.1" visible="false" scale="0.1 0.1 0.1" fade-out></a-entity>
      <a-entity id="banana-template" gltf-model="#banana-model" class="falling-ingredient incorrect" data-name="banana" dynamic-body="shape: box; mass: 0.2" visible="false" scale="0.1 0.1 0.1" fade-out></a-entity>
      <a-entity id="salt-template" gltf-model="#salt-model" class="falling-ingredient incorrect" data-name="salt" dynamic-body="shape: box; mass: 0.2" visible="false" scale="0.1 0.1 0.1" fade-out></a-entity>
      <a-entity id="knife-template" gltf-model="#knife-model" class="falling-ingredient incorrect" data-name="knife" dynamic-body="shape: box; mass: 0.2" visible="false" scale="0.1 0.1 0.1" fade-out></a-entity>
      <a-entity id="spatula-template" gltf-model="#spatula-model" class="falling-ingredient incorrect" data-name="spatula" dynamic-body="shape: box; mass: 0.2" visible="false" scale="0.1 0.1 0.1" fade-out></a-entity>
      <a-entity id="whisk-template" gltf-model="#whisk-model" class="falling-ingredient incorrect" data-name="whisk" dynamic-body="shape: box; mass: 0.2" visible="false" scale="0.1 0.1 0.1" fade-out></a-entity>
    </a-assets>
    
    <a-entity camera position="0 2 10" look-at="#player-bowl"></a-entity>
    <a-entity light="type:ambient; intensity:0.5"></a-entity>
    <a-entity light="type:directional; intensity:0.8" position="0 2 1"></a-entity>
    <a-plane id="physical-floor" static-body position="0 0 0" rotation="-90 0 0" width="10" height="10" visible="false"></a-plane> 
    
    <a-entity id="backwall" gltf-model="#backwall-model" static-body="shape: box;" position="0 0 -5"></a-entity>
    <a-entity id="frontwall" gltf-model="#frontwall-model" static-body="shape: box;" position="0 0 5"></a-entity>
    <a-entity id="rightwall" gltf-model="#rightwall-model" static-body="shape: box;" position="5 0 0"></a-entity>
    <a-entity id="leftwall" gltf-model="#leftwall-model" static-body="shape: box;" position="-5 0 0"></a-entity>
    <a-entity id="floor-model-entity" gltf-model="#floor-model" position="0 0 0"></a-entity>
    <a-entity id="fridge" gltf-model="#fridge-model" static-body="shape: box;"></a-entity>
    <a-entity id="roof-model-entity" gltf-model="#roof-model" static-body="shape: box;" position="0 5 0"></a-entity>
    <a-entity id="counterdecor" gltf-model="#counterdecor-model" static-body="shape: box;"></a-entity>
    <a-entity id="counters" gltf-model="#counters-model" static-body="shape: box;"></a-entity>
    <a-entity id="radio" gltf-model="#radio-model" static-body="shape: box;"></a-entity>
    <a-entity id="light-model-entity" gltf-model="#light-model" static-body="shape: box;"></a-entity>
    <a-entity id="salt-static" gltf-model="#salt-model" static-body="shape: box;"></a-entity>
    <a-entity id="eggcarton-static" gltf-model="#eggcarton-model" static-body="shape: box;"></a-entity>
    <a-entity id="player-bowl" gltf-model="#mixingbowl-model" position="0 1 -3" rotation="0 180 0" scale="0.5 0.5 0.5" player-movement collision-listener></a-entity> 
    <a-entity id="cuttingboard-static" gltf-model="#cuttingboard-model" static-body="shape: box;"></a-entity>
    <a-entity id="shelves-static" gltf-model="#shelves-model" static-body="shape: box;"></a-entity>
    <a-entity id="knife-static" gltf-model="#knife-model" static-body="shape: box;"></a-entity>
    <a-entity id="stool-static" gltf-model="#stool-model" static-body="shape: box;"></a-entity>
    <a-entity id="stove-static" gltf-model="#stove-model" static-body="shape: box;"></a-entity>
    <a-entity id="vanilla-static" gltf-model="#vanilla-model" static-body="shape: box;"></a-entity>
    <a-entity id="strawberry-static" gltf-model="#strawberry-model" static-body="shape: sphere; radius: 0.05;"></a-entity>
    <a-entity id="spatula-static" gltf-model="#spatula-model" static-body="shape: box;"></a-entity>
    <a-entity id="whisk-static" gltf-model="#whisk-model" static-body="shape: box;"></a-entity>
    <a-entity id="banana-static" gltf-model="#banana-model" static-body="shape: box;"></a-entity>

    <!-- Final Cake Container -->
    <a-entity id="final-cake-container" position="0 1 -3" visible="false">
        <a-entity id="strawberry-cake-model" gltf-model="#strawberry-cake-model-asset" visible="false"></a-entity>
        <a-entity id="blueberry-cake-model" gltf-model="#blueberry-cake-model-asset" visible="false"></a-entity>
        <a-entity id="cherry-cake-model" gltf-model="#cherry-cake-model-asset" visible="false"></a-entity>
    </a-entity>

    <a-sound id="mainmusic" src="#mainmusic-asset" autoplay="false" loop="true"></a-sound>
  </a-scene>
  
  <script>
    // --- Global Game State Variables ---
    let currentIngredients = [];
    let collectedIngredients = [];
    let incorrectIngredientsCollectedCount = 0;
    let selectedCake = '';
    let ingredientSpawnInterval = null;
    let allPossibleIngredients = [];
    let gameActive = false;

    // --- A-Frame Components ---
    AFRAME.registerComponent('player-movement', { schema: { speed: { type: 'number', default: 0.1 } }, init: function () { this.el.setAttribute('dynamic-body', 'shape: box; mass: 1; linearDamping: 0.99; angularDamping: 0.99'); this.keys = {}; window.addEventListener('keydown', (e) => { this.keys[e.key] = true; }); window.addEventListener('keyup', (e) => { this.keys[e.key] = false; }); }, tick: function () { const el = this.el; let currentPos = el.object3D.position; let newX = currentPos.x; const speed = this.data.speed; const bounds = 4; if (this.keys['ArrowLeft'] || this.keys['a']) { newX -= speed; } if (this.keys['ArrowRight'] || this.keys['d']) { newX += speed; } newX = Math.max(-bounds, Math.min(bounds, newX)); el.object3D.position.x = newX; } });
    AFRAME.registerComponent('collision-listener', { init: function () { this.el.addEventListener('collide', (e) => { const collidedEntity = e.detail.body.el; if (collidedEntity.classList.contains('falling-ingredient')) { const ingredientName = collidedEntity.dataset.name; handleIngredientCollision(ingredientName, collidedEntity); } }); } });
    AFRAME.registerComponent('fade-out', { init: function () { this.el.addEventListener('start-fade', () => { const mesh = this.el.getObject3D('mesh'); if (!mesh) return; mesh.traverse(node => { if (node.isMesh && node.material) { node.material.transparent = true; new AFRAME.TWEEN.Tween({ opacity: node.material.opacity }).to({ opacity: 0 }, 1000).onUpdate(function (object) { node.material.opacity = object.opacity; }).start(); } }); setTimeout(() => { if (this.el.parentNode) { this.el.parentNode.removeChild(this.el); } }, 1000); }); } });

    // --- Game Logic Functions ---
    function startGame(){ document.getElementById('startScreen').style.display='none'; document.getElementById('cakeChoices').style.display='flex'; const music = document.querySelector('#mainmusic'); if(music && music.components.sound && !music.components.sound.isPlaying){ music.components.sound.playSound(); } }

    function chooseCake(cakeName) {
      selectedCake = cakeName;
      document.getElementById('cakeChoices').style.display = 'none';
      document.getElementById('scene').style.display = 'block';

      const recipePanel = document.getElementById('recipePanel');
      recipePanel.style.display = 'block';
      recipePanel.className = cakeName;

      const baseIngredients = ["flour", "sugar", "butter", "milk", "egg"];
      
      if (cakeName === 'strawberry') {
        currentIngredients = [...baseIngredients, "strawberry"];
      } else if (cakeName === 'blueberry') {
        currentIngredients = [...baseIngredients, "blueberry"];
      } else if (cakeName === 'cherry') {
        currentIngredients = [...baseIngredients, "cherries"];
      }

      let recipeHTML = `<h2>${cakeName.charAt(0).toUpperCase() + cakeName.slice(1)} Cake</h2><ul>`;
      currentIngredients.forEach(ingredient => {
        recipeHTML += `<li id="recipe-${ingredient}">${ingredient}</li>`;
      });
      recipeHTML += `</ul>`;
      recipePanel.innerHTML = recipeHTML;

      allPossibleIngredients = [
          'flour-template', 'sugar-template', 'butter-template', 'milk-template', 'egg-template',
          'blueberry-template', 'cherries-template', 'chocolate-template', 'strawberry-template',
          'banana-template', 'salt-template', 'knife-template', 'spatula-template', 'whisk-template'
      ];
      
      startGamePlay();
    }

    function startGamePlay() { gameActive = true; collectedIngredients = []; incorrectIngredientsCollectedCount = 0; document.querySelectorAll('.falling-ingredient').forEach(el => { if (el.parentNode) el.parentNode.removeChild(el) }); ingredientSpawnInterval = setInterval(spawnIngredient, 1500); }
    function spawnIngredient() { if (!gameActive) { clearInterval(ingredientSpawnInterval); return; } const sceneEl = document.querySelector('a-scene'); const randomIndex = Math.floor(Math.random() * allPossibleIngredients.length); const ingredientTemplateId = allPossibleIngredients[randomIndex]; const template = document.getElementById(ingredientTemplateId); if (template) { const newIngredient = template.cloneNode(true); newIngredient.removeAttribute('id'); newIngredient.setAttribute('visible', 'true'); newIngredient.setAttribute('position', { x: (Math.random() * 8) - 4, y: 5, z: (Math.random() * 2) - 1 }); sceneEl.appendChild(newIngredient); newIngredient.addEventListener('body-loaded', function () { this.body.velocity.set(0, 0, 0); this.body.angularVelocity.set(0, 0, 0); }); setTimeout(() => { if (newIngredient.parentNode) { newIngredient.parentNode.removeChild(newIngredient); } }, 8000); } }
    function handleIngredientCollision(ingredientName, entity) { if (!gameActive) return; if (currentIngredients.includes(ingredientName)) { if (!collectedIngredients.includes(ingredientName)) { collectedIngredients.push(ingredientName); const li = document.getElementById(`recipe-${ingredientName}`); if (li) { li.classList.add('collected'); li.innerHTML = `âœ… ${ingredientName}`; } entity.emit('start-fade'); checkCompletion(); } else { entity.emit('start-fade'); } } else { incorrectIngredientsCollectedCount++; restartIngredientCollection(); } }
    function restartIngredientCollection() { incorrectIngredientsCollectedCount = 0; collectedIngredients = []; currentIngredients.forEach(ingredient => { const li = document.getElementById(`recipe-${ingredient}`); if (li) { li.classList.remove('collected'); li.innerHTML = ingredient; } }); document.querySelectorAll('.falling-ingredient').forEach(el => { if (el.parentNode && el.getAttribute('visible')) { el.parentNode.removeChild(el) } }); }
    function checkCompletion() { if (collectedIngredients.length === currentIngredients.length) { startBakingSequence(); } }
    function startBakingSequence() { gameActive = false; clearInterval(ingredientSpawnInterval); document.querySelectorAll('.falling-ingredient').forEach(el => { if (el.parentNode) { el.parentNode.removeChild(el); } }); const loadingContainer = document.getElementById('loading-container'); const loadingBar = document.getElementById('loading-bar'); loadingContainer.style.display = 'block'; let progress = 0; const interval = setInterval(() => { progress += 1; loadingBar.style.width = progress + '%'; loadingBar.textContent = progress + '%'; if (progress >= 100) { clearInterval(interval); loadingContainer.style.display = 'none'; showFinalCake(); } }, 50); }
    function showFinalCake() { document.getElementById('player-bowl').setAttribute('visible', 'false'); const finalCake = document.getElementById('final-cake-container'); const cakeModel = document.getElementById(`${selectedCake}-cake-model`); cakeModel.setAttribute('visible', 'true'); finalCake.setAttribute('visible', 'true'); finalCake.setAttribute('animation', { property: 'scale', from: '0.01 0.01 0.01', to: '1 1 1', dur: 1500, easing: 'easeOutElastic' }); }
  </script>
</body>
</html>
