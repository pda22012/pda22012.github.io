<!DOCTYPE html>
<html>
<head>
  <title>Bake your cake</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.3.0/dist/aframe-physics-system.min.js"></script>
  <style>
    body, html { margin:0; padding:0; height:100%; width:100%; font-family:sans-serif; }
    #startScreen, #cakeChoices { position:absolute; top:0; left:0; width:100%; height:100%; display:flex; flex-direction:column; justify-content:center; align-items:center; background-size:cover; z-index:10; }
    #startScreen { background: url('https://cdn.pixabay.com/photo/2015/01/14/19/20/bake-599521_1280.jpg') no-repeat center center; }
    #startScreen::before, #cakeChoices::before { content:""; position:absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index:-1; }
    #cakeChoices { background: url('https://cdn.pixabay.com/photo/2015/01/14/19/20/bake-599521_1280.jpg') no-repeat center center; display:none; }
    .cake-tab { padding:20px; border-radius:10px; color:white; font-size:20px; cursor:pointer; text-align:center; width:180px; font-weight:bold; margin:10px; }
    #chocolateTab{background-color:#8B4513;} #blueberryTab{background-color:#1E90FF;} #cherryTab{background-color:#FF69B4;}
    #recipePanel { position:absolute; top:20%; left:5%; padding:20px; border-radius:12px; font-size:18px; display:none; z-index:10; min-width:200px; color:white; }
    #recipePanel h2 { margin-top:0; font-size:22px; text-align:center; }
    #recipePanel ul { list-style:none; padding:0; }
    #recipePanel li { margin:5px 0; font-weight:bold; }
    #recipePanel li.collected { color:lightgreen; }
    #recipePanel.chocolate { background-color:#8B4513; }
    #recipePanel.blueberry { background-color:#1E90FF; }
    #recipePanel.cherry { background-color:#FF69B4; }
  </style>
</head>
<body>
  <div id="startScreen">
    <h1 style="color:white;">Bake your cake</h1>
    <button onclick="startGame()">Start</button>
  </div>

  <div id="cakeChoices">
    <div id="chocolateTab" class="cake-tab" onclick="chooseCake('chocolate')">Chocolate Cake</div>
    <div id="blueberryTab" class="cake-tab" onclick="chooseCake('blueberry')">Blueberry Cake</div>
    <div id="cherryTab" class="cake-tab" onclick="chooseCake('cherry')">Cherry Cake</div>
  </div>

  <div id="recipePanel"></div>

  <a-scene id="scene" physics="gravity:-9.8" style="display:none;">
    <!-- Player camera with collision -->
    <a-entity id="player" kinematic-body position="0 45 0">
      <a-entity id="cameraRig" camera look-controls wasd-controls="acceleration:150" position="0 1.6 0">
        <a-entity cursor="fuse:false; rayOrigin:mouse" 
                  raycaster="objects:.click-target" 
                  position="0 0 -1" 
                  geometry="primitive:ring; radiusInner:0.01; radiusOuter:0.015" 
                  material="color:black; shader:flat">
        </a-entity>
      </a-entity>
    </a-entity>

    <!-- Lights -->
    <a-entity light="type:ambient; intensity:0.5"></a-entity>
    <a-entity light="type:directional; intensity:0.8" position="0 2 1"></a-entity>

    <!-- Full kitchen objects with colliders -->
    <a-entity id="backwall" gltf-model="backwall.glb" static-body></a-entity>
    <a-entity id="frontwall" gltf-model="frontwall.glb" static-body></a-entity>
    <a-entity id="rightwall" gltf-model="rightwall.glb" static-body></a-entity>
    <a-entity id="leftwall" gltf-model="leftwall.glb" static-body></a-entity>
    <a-entity id="floor" gltf-model="floor.glb" static-body></a-entity>
    <a-entity id="fridge" gltf-model="fridge.glb" static-body></a-entity>
    <a-entity id="roof" gltf-model="roof.glb" static-body></a-entity>
    <a-entity id="counterdecor" gltf-model="counterdecor.glb" static-body></a-entity>
    <a-entity id="counters" gltf-model="counters.glb" static-body></a-entity>
    <a-entity id="radio" gltf-model="radio.glb" static-body></a-entity>
    <a-entity id="light" gltf-model="light.glb" static-body></a-entity>
    <a-entity id="salt" gltf-model="salt.glb" static-body></a-entity>
    <a-entity id="eggcarton" gltf-model="eggcarton.glb" static-body></a-entity>
    <a-entity id="mixingbowl" gltf-model="mixingbowl.glb" static-body></a-entity>
    <a-entity id="cuttingboard" gltf-model="cuttingboard.glb" static-body></a-entity>
    <a-entity id="shelves" gltf-model="shelves.glb" static-body></a-entity>
    <a-entity id="knife" gltf-model="knife.glb" static-body></a-entity>
    <a-entity id="stool" gltf-model="stool.glb" static-body></a-entity>
    <a-entity id="stove" gltf-model="stove.glb" static-body></a-entity>

    <!-- Collectables with invisible box for raycasting -->
    <a-entity id="flour" gltf-model="flour.glb" class="collectable" data-name="flour" static-body>
      <a-box class="click-target" opacity="0.01" position="0 0 0" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="sugar" gltf-model="sugar.glb" class="collectable" data-name="sugar" static-body>
      <a-box class="click-target" opacity="0.01" position="0 0 0" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="butter" gltf-model="butter.glb" class="collectable" data-name="butter" static-body>
      <a-box class="click-target" opacity="0.01" position="0 0 0" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="milk" gltf-model="milk.glb" class="collectable" data-name="milk" static-body>
      <a-box class="click-target" opacity="0.01" position="0 0 0" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="vanilla" gltf-model="vanilla.glb" class="collectable" data-name="vanilla" static-body>
      <a-box class="click-target" opacity="0.01" position="0 0 0" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="blueberry" gltf-model="blueberry.glb" class="collectable" data-name="blueberry" static-body>
      <a-box class="click-target" opacity="0.01" position="0 0 0" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="strawberry" gltf-model="strawberry.glb" class="collectable" data-name="strawberry" static-body>
      <a-box class="click-target" opacity="0.01" position="0 0 0" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="chocolate" gltf-model="chocolate.glb" class="collectable" data-name="chocolate" static-body>
      <a-box class="click-target" opacity="0.01" position="0 0 0" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="spatula" gltf-model="spatula.glb" class="collectable" data-name="spatula" static-body>
      <a-box class="click-target" opacity="0.01" position="0 0 0" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="whisk" gltf-model="whisk.glb" class="collectable" data-name="whisk" static-body>
      <a-box class="click-target" opacity="0.01" position="0 0 0" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="banana" gltf-model="banana.glb" class="collectable" data-name="banana" static-body>
      <a-box class="click-target" opacity="0.01" position="0 0 0" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="cherries" gltf-model="cherries.glb" class="collectable" data-name="cherries" static-body>
      <a-box class="click-target" opacity="0.01" position="0 0 0" scale="2 2 2"></a-box>
    </a-entity>
    <a-entity id="egg" gltf-model="egg.glb" class="collectable" data-name="egg" static-body>
      <a-box class="click-target" opacity="0.01" position="0 0 0" scale="2 2 2"></a-box>
    </a-entity>

    <!-- Floating 3D text for collection -->
    <a-entity id="collect-text" text="value: Press E to collect; color: yellow; align:center" visible="false"></a-entity>

    <!-- Music -->
    <a-sound id="mainmusic" src="baking cooking jazz.mp3" autoplay="false" loop="true"></a-sound>
  </a-scene>

  <script>
    let currentIngredients = [];

    function startGame() {
      document.getElementById('startScreen').style.display = 'none';
      document.getElementById('cakeChoices').style.display = 'flex';

      const music = document.querySelector('#mainmusic');
      if (music && music.components && music.components.sound && !music.components.sound.isPlaying) {
        music.components.sound.playSound();
      }
    }

    function chooseCake(cakeName) {
      document.getElementById('cakeChoices').style.display = 'none';
      document.getElementById('scene').style.display = 'block';

      const recipePanel = document.getElementById('recipePanel');
      recipePanel.style.display = 'block';
      recipePanel.className = cakeName;

      if (cakeName === 'blueberry') {
        currentIngredients = ["flour","sugar","butter","milk","vanilla","blueberry","strawberry","spatula","whisk","banana","cherries","egg"];
      } else if (cakeName === 'chocolate') {
        currentIngredients = ["flour","sugar","butter","milk","vanilla","chocolate","strawberry","spatula","whisk","banana","cherries","egg"];
      } else if (cakeName === 'cherry') {
        currentIngredients = ["flour","sugar","butter","milk","vanilla","cherry","spatula","whisk","banana","cherries","egg"];
      }

      recipePanel.innerHTML = `<h2>${cakeName.charAt(0).toUpperCase()+cakeName.slice(1)} Cake</h2>
        <ul>${currentIngredients.map(i => `<li id="recipe-${i.replace(/\s+/g,'-')}"><span class="check"></span> ${i}</li>`).join('')}</ul>`;
    }

    // Collectable component
    AFRAME.registerComponent('collectable-trigger', {
      init: function() {
        const el = this.el;
        const player = document.getElementById('player');
        const collectText = document.getElementById('collect-text');
        let inRange = false;

        this.tick = () => {
          const playerPos = new THREE.Vector3();
          const objPos = new THREE.Vector3();
          player.object3D.getWorldPosition(playerPos);
          el.object3D.getWorldPosition(objPos);
          const distance = playerPos.distanceTo(objPos);

          if (distance < 2) {
            if (!inRange) {
              inRange = true;
              collectText.setAttribute('visible', true);
            }
            collectText.object3D.position.copy(objPos.clone().add(new THREE.Vector3(0, 0.5, 0)));
          } else if (inRange) {
            inRange = false;
            collectText.setAttribute('visible', false);
          }
        };
      }
    });

    document.addEventListener('DOMContentLoaded', () => {
      const collectables = document.querySelectorAll('.collectable');
      collectables.forEach(c => c.setAttribute('collectable-trigger',''));

      document.addEventListener('keydown', function(e) {
        if(e.key.toLowerCase() !== 'e') return;

        const player = document.getElementById('player');
        const collectText = document.getElementById('collect-text');

        collectables.forEach(c => {
          const playerPos = new THREE.Vector3();
          const objPos = new THREE.Vector3();
          player.object3D.getWorldPosition(playerPos);
          c.object3D.getWorldPosition(objPos);
          const distance = playerPos.distanceTo(objPos);

          if(distance < 2 && currentIngredients.includes(c.getAttribute('data-name'))) {
            c.setAttribute('visible','false');
            collectText.setAttribute('visible','false');

            const li = document.getElementById(`recipe-${c.getAttribute('data-name').replace(/\s+/g,'-')}`);
            if(li){ li.querySelector('.check').textContent='âœ…'; li.classList.add('collected'); }
          }
        });
      });
    });
  </script>
</body>
</html>
