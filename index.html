<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Bake your cake</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-physics-system@v3.3.0/dist/aframe-physics-system.min.js"></script>

  <style>
    body, html { margin:0; padding:0; height:100%; width:100%; font-family:sans-serif; }
    #startScreen, #cakeChoices {
      position:absolute; top:0; left:0; width:100%; height:100%;
      display:flex; flex-direction:column; justify-content:center; align-items:center;
      background-size:cover; z-index:10;
    }
    #startScreen { background: url('https://cdn.pixabay.com/photo/2015/01/14/19/20/bake-599521_1280.jpg') no-repeat center center; }
    #startScreen::before, #cakeChoices::before {
      content:""; position:absolute; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.5); z-index:-1;
    }
    #cakeChoices { background: url('https://cdn.pixabay.com/photo/2015/01/14/19/20/bake-599521_1280.jpg') no-repeat center center; display:none; }
    .cake-tab { padding:20px; border-radius:10px; color:white; font-size:20px; cursor:pointer; text-align:center; width:180px; font-weight:bold; margin:10px; }
    #chocolateTab{background-color:#8B4513;} #blueberryTab{background-color:#1E90FF;} #cherryTab{background-color:#FF69B4;}

    #recipePanel {
      position:absolute; top:12%; left:12px; padding:14px; border-radius:10px;
      font-size:16px; display:none; z-index:200; min-width:220px; color:white;
      background: rgba(0,0,0,0.55);
    }
    #recipePanel h2 { margin:4px 0 8px 0; font-size:20px; text-align:center; }
    #recipePanel ul { list-style:none; padding:0; margin:0; }
    #recipePanel li { margin:6px 0; font-weight:600; display:flex; align-items:center; gap:8px; }
    #recipePanel .check { width:20px; display:inline-block; text-align:center; }

    /* keep scene below UI */
    a-scene { width:100%; height:100%; }
  </style>
</head>
<body>
  <div id="startScreen">
    <h1 style="color:white; margin-bottom:18px;">Bake your cake</h1>
    <button onclick="startGame()" style="padding:12px 18px; font-size:16px;">Start</button>
  </div>

  <div id="cakeChoices">
    <div id="chocolateTab" class="cake-tab" onclick="chooseCake('chocolate')">Chocolate Cake</div>
    <div id="blueberryTab" class="cake-tab" onclick="chooseCake('blueberry')">Blueberry Cake</div>
    <div id="cherryTab" class="cake-tab" onclick="chooseCake('cherry')">Cherry Cake</div>
  </div>

  <div id="recipePanel"></div>

  <a-scene id="scene" style="display:none;" physics="gravity: -9.8;">

    <!-- PLAYER + CAMERA RIG: height is 60 (unchanged) -->
    <a-entity id="player" position="0 0 0">
      <a-entity id="cameraRig"
                camera
                look-controls
                wasd-controls="acceleration: 150"
                position="0 50 0"> <!-- PLAYER HEIGHT: 60 (kept as requested) -->

        <!-- center-screen cursor: rayOrigin = entity (shoots forward from camera) -->
        <a-entity id="centerCursor"
                  cursor="fuse: false; rayOrigin: entity"
                  raycaster="objects: .click-target"
                  position="0 0 -0.5"
                  geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.015"
                  material="color: black; shader: flat">
        </a-entity>

      </a-entity>
    </a-entity>

    <!-- lighting -->
    <a-entity light="type:ambient; intensity:0.6"></a-entity>
    <a-entity light="type:directional; intensity:0.8" position="0 8 4"></a-entity>

    <!-- KITCHEN (kept exactly as you provided) -->
    <a-entity id="backwall"  gltf-model="backwall.glb"  material="side: double; depthTest: true;" static-body></a-entity>
    <a-entity id="frontwall" gltf-model="frontwall.glb" material="side: double; depthTest: true;" static-body></a-entity>
    <a-entity id="rightwall" gltf-model="rightwall.glb" material="side: double; depthTest: true;" static-body></a-entity>
    <a-entity id="leftwall"  gltf-model="leftwall.glb"  material="side: double; depthTest: true;" static-body></a-entity>
    <a-entity id="floor"     gltf-model="floor.glb"      material="side: double; depthTest: true;" static-body></a-entity>
    <a-entity id="fridge"    gltf-model="fridge.glb"     material="side: double; depthTest: true;" static-body></a-entity>
    <a-entity id="roof"      gltf-model="roof.glb"       static-body></a-entity>
    <a-entity id="counterdecor" gltf-model="counterdecor.glb" material="side: double; depthTest: true;" static-body></a-entity>
    <a-entity id="counters"  gltf-model="counters.glb"   material="side: double; depthTest: true;" static-body></a-entity>
    <a-entity id="radio"     gltf-model="radio.glb"      material="side: double; depthTest: true;" static-body></a-entity>
    <a-entity id="light"     gltf-model="light.glb"      material="side: double; depthTest: true;" static-body></a-entity>
    <a-entity id="salt"      gltf-model="salt.glb"       material="side: double; depthTest: true;" static-body></a-entity>
    <a-entity id="eggcarton" gltf-model="eggcarton.glb"  material="side: double; depthTest: true;" static-body></a-entity>
    <a-entity id="mixingbowl" gltf-model="mixingbowl.glb" material="side: double; depthTest: true;" static-body></a-entity>
    <a-entity id="cuttingboard" gltf-model="cuttingboard.glb" material="side: double; depthTest: true;" static-body></a-entity>
    <a-entity id="shelves"   gltf-model="shelves.glb"    material="side: double; depthTest: true;" static-body></a-entity>
    <a-entity id="knife"     gltf-model="knife.glb"      material="side: double; depthTest: true;" static-body></a-entity>
    <a-entity id="stool"     gltf-model="stool.glb"      material="side: double; depthTest: true;" static-body></a-entity>
    <a-entity id="stove"     gltf-model="stove.glb"      material="side: double; depthTest: true;" static-body></a-entity>

    <!-- COLLECTABLES: EXACT positions/scales are preserved inside the glb files.
         Each has an invisible .click-target child (hitbox) positioned at 0 0 0
         relative to the model so it doesn't move your model around. -->
    <a-entity id="flour" gltf-model="flour.glb" class="collectable" collectable data-name="flour">
      <a-box class="click-target" visible="false" position="0 0 0" scale="0.8 0.8 0.8"></a-box>
    </a-entity>

    <a-entity id="peanutbutter" gltf-model="peanutbutter.glb" class="collectable" collectable data-name="peanut butter">
      <a-box class="click-target" visible="false" position="0 0 0" scale="0.8 0.8 0.8"></a-box>
    </a-entity>

    <a-entity id="sugar" gltf-model="sugar.glb" class="collectable" collectable data-name="sugar">
      <a-box class="click-target" visible="false" position="0 0 0" scale="0.8 0.8 0.8"></a-box>
    </a-entity>

    <a-entity id="butter" gltf-model="butter.glb" class="collectable" collectable data-name="butter">
      <a-box class="click-target" visible="false" position="0 0 0" scale="0.8 0.8 0.8"></a-box>
    </a-entity>

    <a-entity id="milk" gltf-model="milk.glb" class="collectable" collectable data-name="milk">
      <a-box class="click-target" visible="false" position="0 0 0" scale="0.8 0.8 0.8"></a-box>
    </a-entity>

    <a-entity id="vanilla" gltf-model="vanilla.glb" class="collectable" collectable data-name="vanilla">
      <a-box class="click-target" visible="false" position="0 0 0" scale="0.8 0.8 0.8"></a-box>
    </a-entity>

    <a-entity id="blueberry" gltf-model="blueberry.glb" class="collectable" collectable data-name="blueberry">
      <a-box class="click-target" visible="false" position="0 0 0" scale="0.8 0.8 0.8"></a-box>
    </a-entity>

    <a-entity id="strawberry" gltf-model="strawberry.glb" class="collectable" collectable data-name="strawberry">
      <a-box class="click-target" visible="false" position="0 0 0" scale="0.8 0.8 0.8"></a-box>
    </a-entity>

    <a-entity id="spatula" gltf-model="spatula.glb" class="collectable" collectable data-name="spatula">
      <a-box class="click-target" visible="false" position="0 0 0" scale="0.8 0.8 0.8"></a-box>
    </a-entity>

    <a-entity id="chocolate" gltf-model="chocolate.glb" class="collectable" collectable data-name="chocolate">
      <a-box class="click-target" visible="false" position="0 0 0" scale="0.8 0.8 0.8"></a-box>
    </a-entity>

    <a-entity id="whisk" gltf-model="whisk.glb" class="collectable" collectable data-name="whisk">
      <a-box class="click-target" visible="false" position="0 0 0" scale="0.8 0.8 0.8"></a-box>
    </a-entity>

    <a-sound id="mainmusic" src="baking cooking jazz.mp3" autoplay="false" loop="true"></a-sound>
  </a-scene>

  <script>
    // sanitize function: "peanut butter" -> "peanut-butter"
    function sanitizeId(name){ return name.replace(/\s+/g, '-'); }

    // Start / recipe logic
    let currentIngredients = [];
    function startGame(){
      document.getElementById('startScreen').style.display='none';
      document.getElementById('cakeChoices').style.display='flex';
    }

    function chooseCake(cakeName){
      document.getElementById('cakeChoices').style.display='none';
      document.getElementById('scene').style.display='block';

      const recipePanel = document.getElementById('recipePanel');
      recipePanel.style.display='block';
      recipePanel.className = cakeName;

      if(cakeName==='blueberry'){
        currentIngredients = ["flour","sugar","butter","milk","vanilla","blueberry","strawberry","spatula","whisk"];
      } else if(cakeName==='chocolate'){
        currentIngredients = ["flour","sugar","butter","milk","vanilla","chocolate","strawberry","spatula","whisk"];
      } else if(cakeName==='cherry'){
        currentIngredients = ["flour","sugar","butter","milk","vanilla","cherry","spatula","whisk"];
      }

      recipePanel.innerHTML = `<h2>${cakeName.charAt(0).toUpperCase()+cakeName.slice(1)} Cake</h2>
        <ul>${currentIngredients.map(i=>`<li id="recipe-${sanitizeId(i)}"><span class="check"></span> ${i}</li>`).join('')}</ul>`;
    }

    // collectable component: clicks on the invisible child .click-target
    AFRAME.registerComponent('collectable', {
      init: function () {
        // prefer click on the click-target child (hitbox). If not present, handle clicks on the entity itself.
        const hit = this.el.querySelector('.click-target') || this.el;
        hit.addEventListener('click', (evt) => {
          // stop event from bubbling to scene
          evt.stopPropagation();

          const rawName = this.el.getAttribute('data-name') || this.el.id || '';
          const normalized = rawName.toLowerCase();
          // find matching currentIngredients item ignoring case/whitespace differences
          const match = currentIngredients.find(i => i.toLowerCase() === normalized || sanitizeId(i) === sanitizeId(rawName));
          if (!match) return;

          // hide the model (visual)
          this.el.setAttribute('visible', 'false');

          // tick recipe
          const li = document.getElementById(`recipe-${sanitizeId(match)}`);
          if (li) {
            const check = li.querySelector('.check');
            if (check) check.textContent = '✅';
            li.classList.add('collected');
          }
        });
      }
    });

    // make loaded glTF materials double-sided (prevents see-through)
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('a-entity[gltf-model]').forEach(ent => {
        ent.addEventListener('model-loaded', (ev) => {
          try {
            const gltf = ev.detail.model;
            const scene = gltf.scene || gltf;
            scene.traverse(node => {
              if (node.isMesh && node.material) {
                if (Array.isArray(node.material)) {
                  node.material.forEach(m => { if (m) { m.side = THREE.DoubleSide; m.needsUpdate = true; }});
                } else {
                  node.material.side = THREE.DoubleSide;
                  node.material.needsUpdate = true;
                }
              }
            });
          } catch(e){ /* ignore */ }
        });
      });
    });
  </script>
</body>
</html>
